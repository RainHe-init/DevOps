### 部署Harbor仓库
#### 1、硬件环境
![image](https://github.com/498946975/DevOps/blob/master/images/springcloud10.png)
![image](https://github.com/498946975/DevOps/blob/master/images/springcloud11.png)
#### 2、初始化环境配置，和54号文档一致，ip是172.16.120.202
#### 3、简单的功能简介
```yaml
1.基于角色访问控制:用户与 Docker 镜像仓库通过“项目”进行组织管理，一个用户可以对多个镜像仓库在同一命名空间(project)里有不同的权限。
2.镜像复制:镜像可以在多个 Registry 实例中复制(同步)。尤其适合于负载均衡，高可用，混合云和多云的场景。
3.图形化界面:用户可以通过浏览器来浏览，检索当前 Docker 镜像仓库，管理项目和命名空间。 
4.部署简单:提供在线和离线两种安装工具
5.LDAP:Harbor 可以集成企业内部已有的 AD/LDAP，用于鉴权认证管理
```
#### 4、在k8s-harbor主机为harbor签发证书
##### 4.1 生成 ca 证书:
```shell script
[root@k8s-harbor ~]# mkdir /data/ssl -p
[root@k8s-harbor ~]# cd /data/ssl/
```
```shell script
#生成一个 3072 位的 key，也就是私钥
[root@k8s-harbor ssl]# openssl genrsa -out ca.key 3072
```
```shell script
#生成一个数字证书 ca.pem，3650 表示证书的有效时间是 10 年，按箭头提示填写即可，没有箭头标注的为空
[root@k8s-harbor ssl]# openssl req -new -x509 -days 3650 -key ca.key -out ca.pem
```
![image](https://github.com/498946975/DevOps/blob/master/images/springcloud12.png)
##### 4.2 生成域名的证书:
```shell script
#生成一个 3072 位的 key，也就是私钥
[root@k8s-harbor ssl]# openssl genrsa -out harbor.key 3072
```
```shell script
#生成一个证书请求，一会签发证书时需要的，标箭头的按提示填写，没有箭头标注的为空，主机名称必须和安装harbor的主机名称一致
[root@k8s-harbor ssl]# openssl req -new -key harbor.key -out harbor.csr
```
![image](https://github.com/498946975/DevOps/blob/master/images/springcloud13.png)
##### 4.3 签发证书
```shell script
[root@k8s-harbor ssl]# openssl x509 -req -in harbor.csr -CA ca.pem -CAkey ca.key -CAcreateserial -out harbor.pem -days 3650 
Signature ok
subject=/C=CH/ST=BJ/L=BJ/O=Default Company Ltd/CN=k8s-harbor
Getting CA Private Key
您在 /var/spool/mail/root 中有新邮件
[root@k8s-harbor ssl]# 
```
#### 5、查看证书是否有效
```shell script
[root@k8s-harbor ssl]# openssl x509 -noout -text -in harbor.pem
```
