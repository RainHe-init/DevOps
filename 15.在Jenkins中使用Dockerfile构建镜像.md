```yaml
pipeline {
    agent any
    environment {
        DOCKER_URL = 'harbor.liuxiang.com'
        REPOSITORY = 'harbor.liuxiang.com/bookmanager/book_manager'
        TAG = 'v1.1'
    }
    stages {
        stage('Source') {
                steps {
                    dir('/var/lib/jenkins/workspace/book_manager') {
                        git branch: 'PostgreSQL', credentialsId: 'gitlab-sshkey-liuxiang', url: 'ssh://git@gitlab.liuxiang.com:13822/liuxiang/book_manager.git'
                }
            }
        }
        stage('Build') {
            agent {
                dockerfile {
                    dir "/var/lib/jenkins/workspace/book_manager"
                    additionalBuildArgs '-t $REPOSITORY:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
        stage('Push') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'harbor-usename_password-admin', passwordVariable: 'PASSWORD', usernameVariable: 'USERNAME')]){
                    sh 'docker login -u ${USERNAME} -p ${PASSWORD} $DOCKER_URL'
                    sh 'docker push $REPOSITORY:$TAG'
                }
            }
        }
    }
    post { 
        failure {
            updateGitlabCommitStatus name: 'build', state: 'failed'
        }
        success {
            updateGitlabCommitStatus name: 'build', state: 'success'
        }
    }
}
```