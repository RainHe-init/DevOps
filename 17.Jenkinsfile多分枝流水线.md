### Jenkins多分枝流水线
#### 1、先使用docker-compose搭建好Jenkins环境
```shell script
步骤请参考:05,13,14,15这几个文档
```
#### 2、在BookManager项目将Jenkinsfile文件上传至gitlab
```shell script
pipeline {
    agent any
    environment {
        DOCKER_URL = 'harbor.liuxiang.com'
        REPOSITORY = 'harbor.liuxiang.com/bookmanager/book_manager'
        TAG = 'v1.1'
    }
    stages {
        stage('Source') {
                steps {
                    dir('/var/jenkins_home/workspace/BookManager') {
                        git branch: 'PostgreSQL', credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Build') {
            agent {
                dockerfile {
                    dir '/var/jenkins_home/workspace/BookManager'
                    additionalBuildArgs '-t $REPOSITORY:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
        stage('Push') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'harbor-usename_password-admin', passwordVariable: 'PASSWORD', usernameVariable: 'USERNAME')]){
                    sh 'docker login -u ${USERNAME} -p ${PASSWORD} $DOCKER_URL'
                    sh 'docker push $REPOSITORY:$TAG'
                }
            }
        }
    }
    post {
        failure {
            updateGitlabCommitStatus name: 'build', state: 'failed'
        }
        success {
            updateGitlabCommitStatus name: 'build', state: 'success'
        }
    }
}
```
#### 3、在Jenkins中安装GitLab Branch Sources插件
#### 4、在gitlab中创建单独的"访问令牌"
```shell script
1 进入liuxiang(q498946975@163.com)这个用户,密码:ZH...88
2 在右上角点用户头像,然后点击"设置"
3 点击左边的"访问令牌"
4 右边名称: "jenkins-gitlab-branch-sources"
5 范围: 选择"api"
6 点击下面的"Create personal access token"
7 最上面复制已经创建好的令牌信息:"4-E4hUixAP5s7KyQBAzT",该信息只显示一次,建议妥善保存
```
#### 5、将令牌信息保存到Jenkins的凭据
```shell script
1 点击Manage Jenkins里面的Manage Credentials
2 点击"全局"下面的"添加凭据"
3 类型选择:"GitLab API token"
4 范围:"全局"
5 API token: "4-E4hUixAP5s7KyQBAzT"
6 ID: "jenkins-gitlab-branch-sources"
7 描述: "gitlab的liuxiang用户,连接jenkins-gitlab-branch-sources的插件"
```
#### 6、创建多分枝流水线多项目
