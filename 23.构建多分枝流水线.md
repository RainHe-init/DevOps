### 构建gitlab多分枝流水线
#### 1、在Jenkins中安装插件GitLab Branch Sources
```shell script
GitLab Branch Source
    Provides branch source and folder organisation functionality for GitLab Repositories in Jenkins
```
#### 2、
```shell script
pipeline {
    agent any
    environment {
        DOCKER_URL = 'harbor.liuxiang.com'
        REPOSITORY = 'harbor.liuxiang.com/bookmanager/book_manager'
        TAG = 'v1.1'
    }
    stages {
        stage('Source-master') {
            when {
                branch 'master'
            }
            steps {
                dir('/var/jenkins_home/workspace/BookManager') {
                    git branch: 'master', credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Source-PostgreSQL') {
            when {
                branch 'PostgreSQL'
            }
            steps {
                dir('/var/jenkins_home/workspace/BookManager') {
                    git branch: 'PostgreSQL', credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Source-produce') {
            when {
                branch 'produce'
            }
            steps {
                dir('/var/jenkins_home/workspace/BookManager') {
                    git branch: 'produce', credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Source-develop') {
            when {
                branch 'develop'
            }
            steps {
                dir('/var/jenkins_home/workspace/BookManager') {
                    git branch: 'develop', credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Build-master') {
            when {
                branch 'master'
            }
            agent {
                dockerfile {
                    dir '/var/jenkins_home/workspace/BookManager'
                    additionalBuildArgs '-t $REPOSITORY-master:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
        stage('Build-PostgreSQL') {
            when {
                branch 'PostgreSQL'
            }
            agent {
                dockerfile {
                    dir '/var/jenkins_home/workspace/BookManager'
                    additionalBuildArgs '-t $REPOSITORY-PostgreSQL:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
        stage('Build-produce') {
            when {
                branch 'produce'
            }
            agent {
                dockerfile {
                    dir '/var/jenkins_home/workspace/BookManager'
                    additionalBuildArgs '-t $REPOSITORY-produce:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
        stage('Build-develop') {
            when {
                branch 'develop'
            }
            agent {
                dockerfile {
                    dir '/var/jenkins_home/workspace/BookManager'
                    additionalBuildArgs '-t $REPOSITORY-develop:$TAG'
                }
            }
            steps {
                echo 'building'
            }
        }
    }
}
```