### 构建gitlab多分枝流水线
#### 1、在Jenkins中安装插件GitLab Branch Sources
```shell script
GitLab Branch Source
    Provides branch source and folder organisation functionality for GitLab Repositories in Jenkins
```
#### 2、
```shell script
pipeline {
    agent any
    environment {
        DOCKER_URL = 'harbor.liuxiang.com'
        REPOSITORY = 'harbor.liuxiang.com/bookmanager/book_manager'
        TAG = 'v1.1'
    }
    stages {
        stage('Branch master') {
            environment {
                BRANCH_NAME = 'master'
            }
            when {
                branch "${BRANCH_NAME}"
            }
            steps {
                dir("/var/jenkins_home/workspace/BookManager_branch_${BRANCH_NAME}") {
                    git branch: "${BRANCH_NAME}", credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Branch PostgreSQL') {
            environment {
                BRANCH_NAME = 'PostgreSQL'
            }
            when {
                branch "${BRANCH_NAME}"
            }
            steps {
                dir("/var/jenkins_home/workspace/BookManager_branch_${BRANCH_NAME}") {
                    git branch: "${BRANCH_NAME}", credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Branch produce') {
            environment {
                BRANCH_NAME = 'produce'
            }
            when {
                branch "${BRANCH_NAME}"
            }
            steps {
                dir("/var/jenkins_home/workspace/BookManager_branch_${BRANCH_NAME}") {
                    git branch: "${BRANCH_NAME}", credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Branch develop') {
            environment {
                BRANCH_NAME = 'develop'
            }
            when {
                branch "${BRANCH_NAME}"
            }
            steps {
                dir("/var/jenkins_home/workspace/BookManager_branch_${BRANCH_NAME}") {
                    git branch: "${BRANCH_NAME}", credentialsId: 'gtilab-username-password-liuxiang', url: 'http://gitlab.liuxiang.com:13800/liuxiang/book_manager.git'
                }
            }
        }
        stage('Build') {
            agent {
                dockerfile {
                    dir "/var/jenkins_home/workspace/BookManager_branch_${BRANCH_NAME}"
                    additionalBuildArgs '-t $REPOSITORY-${BRANCH_NAME}:$TAG'
                }
            }
            steps {
                echo "${BRANCH_NAME}"
            }
        }
        stage('Push') {
            steps {
                withCredentials([usernamePassword(credentialsId: 'harbor-usename_password-admin', passwordVariable: 'PASSWORD', usernameVariable: 'USERNAME')]){
                    sh "docker login -u ${USERNAME} -p ${PASSWORD} $DOCKER_URL"
                    sh "docker push $REPOSITORY-${BRANCH_NAME}:$TAG"
                }
            }
        }
    }
}
```